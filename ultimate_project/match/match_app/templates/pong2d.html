{% load static %}
<div style="display:none">
	<head>
		<link rel="stylesheet" href="{% static 'match/styles.css' %}">
		<script class="match-script">
			window.rasp = "{{ rasp }}"; 
			window.pidom = "{{ pidom }}";
			window.matchId = "{{ matchId }}";
			window.playerId = "{{ playerId }}";
			window.selfName = "{{ playerName }}";
			window.player2Id = "{{ player2Id }}";
			window.player2Name = "{{ player2Name }}";
		</script>
		<script class="match-script" src="{% static 'match/script.js' %}"
				onload="initMatchWs()"></script>
	</head>
</div>
    <div id="match" class="match-sylvain-gif">
        <!-- <div id="p3"></div> -->
        <div id="spec">
            <img src="https://dansylvain.github.io/pictures/tennis.webp">
        </div>
        <button id="resize-button" onclick="toggleSize()">üîÑ<span>Size</span></button>
        <!-- <h1 id="spec" style="display: none">Je suis spectateur</h1>			 -->
        <div id="p1"></div>
        <div id="p2"></div>
        <div id="ball"></div>
        <div id="waiting">Waiting</div>
        <div class="loader">
            <div class="circle"></div>
            <div class="countdown">3</div>
        </div>
        <div id="end-cont" style="display:none">
        <div id="end"></div>

        </div>
    </div>

<div id="rules-overlay">
    <div id="score">Score</div>
    <p id="inst-right"> <br> </p>
    <p id="inst-left"> <br> </p>
    <p>Be the first one to score 5 points.</p><button id="quit-match-button" onclick="
    stopMatch('{{matchId}}');
    // const rulesOverlay = document.getElementById('rules-overlay');
    // if (rulesOverlay) rulesOverlay.style.display = 'none';
    //     window.gameStartTimestamp = undefined;
    // const matchDiv = document.getElementById('match');
    // setTimeout(()=>{
    //     if (matchDiv) matchDiv.remove(); 
    // }, 3000);
    
   ">GIVE UP</button>
    <button onclick="quitMatch()">BACK</button>
</div>
<script>
    document.body.classList.add("match-active");

    // window.gameInProgress = true;

    // document.addEventListener('keydown', function(e) {
    //     if (window.gameInProgress && ['ArrowUp', 'ArrowDown'].includes(e.key)) {
    //         e.preventDefault();
    //     }
    // });

    window.addEventListener("DOMContentLoaded", () => {
    let lastVisitedPage = history.state?.lastVisitedPage || sessionStorage.getItem("lastVisitedPage");

    console.log("Derni√®re page visit√©e:", lastVisitedPage);
    console.log("Page actuelle:", window.location.href);

    // V√©rifie si une page pr√©c√©dente existe et si l'URL actuelle n'est pas celle de la page d'erreur
    if (lastVisitedPage && window.location.href === lastVisitedPage && !sessionStorage.getItem("redirected")) {
        console.log("Redirection vers la derni√®re page visit√©e :", lastVisitedPage);
        
        // Marque que la redirection a eu lieu pour √©viter la boucle infinie
        sessionStorage.setItem("redirected", "true");

        sessionStorage.setItem("redirected", "true");
    } else {
        sessionStorage.removeItem("redirected");
        console.log("Aucune page pr√©c√©dente trouv√©e ou d√©j√† sur la page visit√©e.");
    }
});

function toggleSize() {
        const match = document.getElementById('match');
        
        // Toggle la classe 'small-size' sur #match
        match.classList.toggle('small-size');
        document.activeElement.blur();
    }

</script>