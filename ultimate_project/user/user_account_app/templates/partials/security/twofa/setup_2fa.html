{% load static %}
<div id="setup-2fa-content" class="container-fluid m-0 p-0">
  <!-- Page Heading -->
  <h1 data-translate="SETUP 2FA" class="h3 mb-3 my-2 mx-2 font-weight: 800">
    Set Up Two-Factor Authentication (2FA) for <strong>{{ username }}</strong>
  </h1>
  <h2 class="mb-4 mx-2">
    Two-factor authentication adds an extra layer of security to your account by
    requiring more than just a password to sign in.
  </h2>

  <div class="row justify-content-center">
    <!-- QR CODE COLUMN -->
    <div class="col-lg-6 mb-4">
      <div class="card shadow mb-4 h-100 mx-auto" style="width: 95%;">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold">
            Step 1: Scan QR Code
          </h6>
        </div>
        <div class="card-body text-center">
          <p>
            Scan the QR code with your authenticator app (like Google
            Authenticator, Authy, or Microsoft Authenticator)
          </p>
          {% if qr_code %}
          <img
            src="{{ qr_code }}"
            alt="QR Code"
            class="img-fluid"
            style="max-width: 250px"
          />
          {% else %}
          <div class="alert alert-danger">Error generating QR code</div>
          {% endif %}
          <p class="mt-3 text-xs">Or manually enter this key in your app:</p>
          <p class="mt-3 text-xs" id="secret_key">
            <strong>{{ secret }}</strong>
          </p>
        </div>
      </div>
    </div>

    <!-- VERIFY CODE FORM COLUMN -->
    <div class="col-lg-6 mb-4">
      <div class="card shadow mb-4 h-100 mx-auto" style="width: 95%;">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold">Step 2: Verify Code</h6>
        </div>
        <div class="card-body">
          <form
            hx-post="/account/security/verify-2fa/"
            hx-target="#account-content"
            hx-push-url="true"
            hx-ext="csrf"
          >
            {% csrf_token %}
            <div class="form-group">
              <label for="otp_input">Enter the code generated by your authenticator app:</label>
              <input
                id="otp_input"
                type="number"
                name="token"
                maxlength="6"
                class="form-control form-control-user"
                placeholder="Enter 6-digit code"
                required
              />
            </div>
            <div class="form-group mt-4">
              <button
                type="submit"
                class="btn btn-primary btn-rounded btn-block"
                id="otp_verify"
              >
                Verify and Activate
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- CANCEL BUTTON -->
  <div class="row justify-content-center">
    <div class="col-lg-6 mb-4">
      <a
        href="/account/security/"
        class="btn btn-danger-custom btn-rounded btn-block mt-2"
        hx-get="/account/security/"
        hx-target="#account-content"
        hx-push-url="true"
      >
        Cancel
      </a>
    </div>
  </div>
</div>

<style>
  .btn-rounded {
    border-radius: 50px;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    text-align: center;
    border-width: 2px;
    background-color: transparent;
    border-color: #1cc88a;
    color: #1cc88a;
    transition: background-color 0.3s, color 0.3s, border-color 0.3s;
  }

  .btn-rounded:hover {
    background-color: #1cc88a;
    color: white;
    border-color: #1cc88a;
    text-decoration: none;
  }

  .btn-rounded:focus {
    background-color: #1cc88a;
    color: white;
    border-color: #1cc88a;
  }

  .btn-danger-custom {
    border-color: #e74a3b;
    color: #e74a3b;
    background-color: transparent;
  }

  .btn-danger-custom.active,
  .btn-danger-custom:focus {
    background-color: #e74a3b !important;
    color: #f8f9fc;
    border-color: #e74a3b !important;
  }

  .btn-danger-custom:hover {
    background-color: #e74a3b;
    color: #f8f9fc;
    border-color: #e74a3b;
  }
</style>
